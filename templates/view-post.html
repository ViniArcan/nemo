{% extends './partials/base_layout.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/separador.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/generic-pages.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/post-showcase.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
{% endblock %}

{% block content %}
<div class="div-separadora">
    <h1>{{ post.title }}</h1>
</div>
<div class="post-content-container">
    <p class="description">{{ post.desc }}</p>
    {% if post.image_path %}
    <img src="{{ url_for('static', filename=post.image_path.replace('static/', '')) }}" alt="Featured Image">
    {% endif %}
    
    <div id="post-actual-content"></div>
    <textarea style="display:none;" id="raw-content">{{ post.content }}</textarea>

    <p class="post-publish-date"><i>Publicado em {{ post.date.strftime('%d/%m/%Y') }}</i></p>
</div>

{% if logado %}
<form action="{{ url_for('post_editor', post_id=post.id) }}" method="get">
    <button type="submit">Editar</button>
</form>
<form action="{{ url_for('delete_post', post_id=post.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this post?');">
    <button type="submit">Deletar</button>
</form>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // CKEditor saves content as HTML, so we just need to display it.
        // MathJax will automatically find and render any <math> tags.
        var htmlContent = document.getElementById('raw-content').value;
        var contentDiv = document.getElementById('post-actual-content');
        contentDiv.innerHTML = htmlContent;
    });
</script>
{% endblock %}